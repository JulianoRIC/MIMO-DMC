clear all
clc

syms z 

%funcoes de transferencia  simbolicas em relacao a MV
G11 =  vpa((0.000298*z + 0.002566) / (z^2 -1.751*z + 0.755),4);
G12 =  vpa((0.007106*z + 0.007004) / (z -0.9714),4); 
G18 =  vpa((-0.03856*z^2 + 0.009548*z + 1.798e-5)/ (z^2 -0.9042*z+ 5.752e-7),7);
G25 =  vpa((-0.022697*z -0.0136)/ (z^2 -1.112*z+ 0.2116),4); 
G35 =  vpa((0.007741*z+ 0.003937)/ (z^2 -0.9584*z + 1.897e-5),4);
G38 =   vpa((-0.007009)/ (z -0.9584),4);
G41 =  vpa((-0.04949*z^2 + 0.01427*z + 3.437e-5) / (z^2 -0.968*z + 1.17e-6),7);
G42 =  vpa((-0.03625*z + 0.007826)/ (z -0.9672),4);
G44 =  vpa((5.352) /(z  -0.5134),4);
G48 =  vpa((0.02216*z -0.01418)/ (z^2 -1.679*z + 0.6918),4);
G54 =  vpa((-0.2807*z + 0.01537) / (z^2 -1.469*z + 0.5332),4); 
G56 = vpa((-0.04508*z + 0.03108) / (z^2 -1.249*z + 0.3724),4);
G57 =  vpa((0.04439*z -0.03667)/ (z^2 -1.817*z + 0.8272),4);
G66 =  vpa((0.2632*z + 0.1493) /(z^2 -0.7659*z + 0.1859),4);
G71 =   vpa((-0.02409*z + 0.0234)/(z^2 -0.9984*z+ 0.02156),4);
G81 =  vpa((0.0009344)/ (z -0.9445),4);
G82 =  vpa((-0.004995)/ (z -0.9445),4); 
G83 =  vpa((-0.006484*z + 0.004228)/ (z^2 -1.432*z + 0.4647),4);
G88 =  vpa((-0.0002795*z^2 + 0.0003478*z +0.0003198)/(z^2 -1.652*z + 0.6869),4);

%coeficientes das funcoes transferencias discretas
[A11, B11] = numden(G11);
[A12, B12] = numden(G12);
[A18, B18] =numden(G18);
[A25, B25] = numden(G25);
[A35, B35] = numden(G35);
[A38, B38] = numden(G38);
[A41, B41] = numden(G41);
[A42, B42] = numden(G42);
[A44, B44] = numden(G44);
[A48, B48] = numden(G48);
[A54, B54] =numden(G54);
[A56, B56] = numden(G56);
[A57, B57] =numden(G57);
[A66, B66] = numden(G66);
[A71, B71] = numden(G71);
[A81, B81] = numden(G81);
[A82, B82] =numden(G82);
[A83, B83] = numden(G83);
[A88, B88] = numden(G88);


A11 = vpa(A11,16);
B11 = vpa(B11,16);
A12 = vpa(A12,16);
B12 = vpa(B12,16);
A18 = vpa(A18,16);
B18 = vpa(B18,16);
A25 = vpa(A25,16);
B25 = vpa(B25,16);
A35 = vpa(A35,16);
B35 = vpa(B35,16);
A38 = vpa(A38,16);
B38 = vpa(B38,16);
A41 = vpa(A41,16);
B41 = vpa(B41,16);
A42 = vpa(A42,16);
B42 = vpa(B42,16);
A44 = vpa(A44,16);
B44 = vpa(B44,16);
A48 = vpa(A48,16);
B48 = vpa(B48,16);
A54 = vpa(A54,16);
B54 = vpa(B54,16);
A56 = vpa(A56,16);
B56 = vpa(B56,16);
A57 = vpa(A57,16);
B57 = vpa(B57,16);
A66 = vpa(A66,16);
B66 = vpa(B66,16);
A71 = vpa(A71,16);
B71 = vpa(B71,16);
A81 = vpa(A81,16);
B81 = vpa(B81,16);
A82 = vpa(A82,16);
B82 = vpa(B82,16);
A83 = vpa(A83,16);
B83 = vpa(B83,16);
A88 = vpa(A88,16);
B88 = vpa(B88,16);

%% MOntando expressoes

syms u1 u2 u3 u4 u5 u6 u7 u8
 
y1 = vpa( simplify(expand( ((B12*B18*A11)*u1 + (B11*B18*A12)*u2 + (B11*B12*A18)*u8)/(B11*B12*B18) )), 4); 
[Ny1, Dy1] = numden(y1);
Ny1 = vpa(Ny1, 4);  Dy1 = vpa(Dy1,4);

y2 = vpa( simplify(expand( ((A25)*u5/B25 ))), 4); 
[Ny2, Dy2] = numden(y2);
Ny2 = vpa(Ny2, 4);  Dy2 = vpa(Dy2,4);

y3 = vpa( simplify(expand( ((B38*A35*u5 + B35*A38*u8)/(B35*B38) ))), 4); 
[Ny3, Dy3] = numden(y3);
Ny3 = vpa(Ny3, 4);  Dy3 = vpa(Dy3,4);

y4 = vpa( simplify(expand( ((A41*B42*B44*B48*u1 + A42*B41*B44*B48*u2 + A44*B41*B42*B48*u4 + A48*B41*B42*B44*u8)/(B41*B42*B44*B48) ))), 4); 
[Ny4, Dy4] = numden(y4);
Ny4 = vpa(Ny4, 4);  Dy4 = vpa(Dy4,4);

y5 = vpa( simplify(expand( ((A54*B56*B57*u4 + A56*B54*B57*u6 + A57*B54*B56*u7)/(B54*B56*B57) ))), 4); 
[Ny5, Dy5] = numden(y5);
Ny5 = vpa(Ny5, 4);  Dy5 = vpa(Dy5,4);

y6 = vpa( simplify(expand( ((A66)*u6/B66 ))), 4); 
[Ny6, Dy6] = numden(y6);
Ny6 = vpa(Ny6, 4);  Dy6 = vpa(Dy6,4);

y7 = vpa( simplify(expand( ((A71)*u7/B71 ))), 4); 
[Ny7, Dy7] = numden(y7);
Ny7 = vpa(Ny7, 4);  Dy7 = vpa(Dy7,4);

y8 = vpa( simplify(expand( ((A81*B82*B83*B88*u1 + A82*B81*B83*B88*u2 + A83*B81*B82*B88*u3 + A88*B81*B82*B83*u8)/(B81*B82*B83*B88) ))), 4); 
[Ny8, Dy8] = numden(y8);
Ny8 = vpa(Ny8, 4);  Dy8 = vpa(Dy8,4);

%A = vpa(sym(0.05))*z/ ( vpa(sym(0.2))*z+2);
%[num, den] = numden(A);


%% Respostas 


y1(k) = ( ( 3.802e29*u2(k-5) - 1.792e29*u1(k-5)  - 1.648e33*u8(k-5) ...
             + 2.817e35*u1(k-4) - 5.977e35*u2(k-4) -8.698e35*u8(k-4)...
             -5.689e35*u1(k-3) + 2.509e35*u1(k-2) + 1.441e35*u2(k-3)...
             +3.725e34*u1(k-1) -2.477e35*u2(k-2) + 6.46e36*u8(k-3)...
             -1.483e36*u2(k-1) - 1.508e37*u8(k-2) + 8.882e35*u2(k)...
             +1.432e37*u8(k-1) - 4.82e36*u8(k) ) + ( 4.533e38*y1(k-1)...
             - 6.147e38*y1(k-2) + 3.693e38*y1(k-3) - 8.289e37*y1(k-4) + 5.273e31*y1(k-5) ) )/ 1.25e38;
         
y2(k) =   (  (-2.2695e31*u5(k-1) - 1.36e31*u5(k-2)) + (1.112e33*y2(k-1) -2.116e32*y2(k-2)) ) /1e33;


y3(k) = ((8.397e34*u8(k-2) - 1.662e30*u8(k-3) - 4.352e34*u5(k-2) - 4.717e34*u5(k-3) ...
            + 9.676e34*u5(k-1) - 8.761e34*u8(k-1)) + (2.396e37*y3(k-1) - 1.148e37*y3(k-2) ...
            + 2.273e32*y3(k-3))) /1.25e37;
        
 y4(k) = ( (7.379e33*u1(k-6) - 2.033e30*u2(k-6) - 2.619e33*u4(k-6) ...
              -5.149e30*u8(k-6) + 3.024e36*u1(k-5) + 1.682e36*u2(k-5) ...
              +2.167e39*u4(k-5) + 4.26e36*u8(k-5) -2.712e37*u1(k-4) ...
              +9.017e37*u1(k-3) - 1.688e37*u2(k-4)-1.418e38*u1(k-2) ...
              +6.01e37*u2(k-3)+1.066e38*u1(k-1)-9.874e37*u2(k-2) -9.736e39*u4(k-4)-3.093e37*u1(k) ) ...
              + (2.58e39*y4(k-1) - 4.208e39*y4(k-2) + 3.384e39*y4(k-3)  - 1.339e39*y4(k-4) + 2.078e38*y4(k-5) - 2.512e32*y4(k-6) ) )/6.25e38;
 
 y5(k) =( ( 1.184e30*u4(k-6) + 3.427e309*u6(k-6) - 1.82e30*u7(k-6) ...
             -2.819e31*u4(k-5) - 2.194e31*u6(k-5) + 1.332e31*u7(k-5) ...
             +1.333e32*u4(k-4) - 2.552e32*u4(k-3) +2.19e32*u4(k-2) ...
             + 5.592e31*u6(k-4) - 7.018e31*u4(k-1) - 7.095e31*u6(k-3) ...
             - 3.858e31*u7(k-4) + 4.48e31*u6(k-2) + 5.533e31*u7(k-3) ...
             -1.127e31*u6(k-1) - 3.933e31*u7(k-2) + 1.11e31*u7(k-1) ) ...
              + (1.134e33*y5(k-1) - 2.127e33*y5(k-2) + 2.11e33*y5(k-3) - 1.167e33*y5(k-4) + 3.411e32*y5(k-5) - 4.106e31*y5(k-6)) )/2.5e32;
          
 y6(k) = (( 1.316e32*u6(k-1) + 7.465e31*u6(k-2) ) + (3.829e32*y6(k-1) - 9.295e31*y6(k-2)) )/5e32;
 
 y7(k) = ( (-12.046e31*u7(k-1) + 11.7e31*u7(k-2) ) + (4.992e33*y7(k-1) - 1.078e32*y7(k-2)))/5e33;
 
 y8(k) =( ( 1.506e30*u2(k-6) - 2.817e29*u1(k-6) + 2.591e30*u3(k-6) ...
              +1.326e29*u8(k-6) + 1.844e30*u1(k-5) - 9.857e30*u2(k-5)...
              -1.569e31*u3(k-5) - 5.451e29*u8(k-5) - 4.741e30*u1(k-4) ...
              +6.008e30*u1(k-3) + 2.534e31*u2(k-4) - 3.764e30*u1(k-2)...
              -3.212e31*u2(k-3) + 3.784e31*u3(k-4) + 9.344e29*u1(k-1)...
              +2.012e31*u2(k-2) - 4.544e31*u3(k-3) -4.995e30*u2(k-1)...
              +2.719e31*u3(k-2) - 6.484e30*u3(k-1) + 4.335e29*u8(k-4)...
              +9.53e29*u8(k-3) - 1.971e30*u8(k-2) + 1.276e30*u8(k-1) -2.795e29*u8(k) ) ...
              +(4.973e33*y8(k-1) - 1.024e34*y8(k-2) + 1.115e34*y8(k-3) - 6.765e33*y8(k-4) + 2.165e33*y8(k-5) - 2.848e32*y8(k-6)))/1e33;
              
 









